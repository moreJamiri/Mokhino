let game=null,t=null,time=0,mainMenu=document.querySelector(".start"),startForm=document.querySelector("#startForm"),scoreMenu=document.querySelector(".endgame"),nav=document.querySelector(".main__nav__ul"),btnOpen=document.querySelector(".main__nav__open"),btnClose=document.querySelector(".main__nav__close");function toPersian(a){return a.toString().replace(/[0-9]/g,a=>String.fromCharCode(a.charCodeAt(0)+1728))}function shuffle(a){let b=a.length,c;for(;0!=b;)c=Math.floor(Math.random()*b),b--,[a[b],a[c]]=[a[c],a[b]];return a}function sleep(a){return new Promise(b=>setTimeout(b,a))}function timer(){time--;let a=("00"+time%60).slice(-2);document.querySelector("#time").innerText=toPersian(`${Math.floor(time/60)}:${a}`),0==time&&game.endGame()}function calcScore(a,b,c){return 5*a-(b-a)+ ~~(c/5)}function getScores(){let a=window.localStorage.getItem("scores");return a?JSON.parse(a):[]}function saveScores(b,c,d){let a=getScores();a.push({moves:c,rights:b,score:calcScore(b,c,d),time:d}),a.sort(function(a,b){return b.score-a.score}),a=a.slice(0,5),window.localStorage.setItem("scores",JSON.stringify(a))}function showScore(a,k){let l=scoreMenu.querySelector("#scoreTitle"),e=scoreMenu.querySelector("#scoreN"),f=scoreMenu.querySelector("#scoreTable"),g=calcScore(a.rights,a.moves,time),d=getScores();if(d=d.length>0?getScores()[0].score:0,l.innerText=k?"\u062A\u0628\u0631\u06CC\u06A9! \u0634\u0645\u0627 \u0628\u0631\u0646\u062F\u0647 \u0634\u062F\u06CC\u062F":"\u0645\u062A\u0627\u0633\u0641\u06CC\u0645! \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F",e.innerText=` ${toPersian(g)}`,g>=d){let h=document.createElement("i");h.classList="record fa fa-trophy",e.prepend(h)}saveScores(a.rights,a.moves,time);let i=getScores();f.innerHTML=`<tr><th>#</th><th>حرکت‌ها</th>
      <th>انتخاب صحیح</th>
      <th>زمان باقیمانده</th>
      <th>امتیاز</th></tr>`;for(let b=0;b<i.length;b++){let c=i[b],j=document.createElement("tr");j.innerHTML=`<td>${toPersian(b+1)}</td>
                    <td>${toPersian(c.moves)}</td>
                    <td>${toPersian(c.rights)}</td>
                    <td>${toPersian(c.time)}</td>
                    <td>${toPersian(c.score)}</td>
                  `,f.appendChild(j)}scoreMenu.style.display="flex"}class Game{icons=["gift","cake","key","bone","heart","star","trophy","shirt","camera","cannabis","car","bell","gem","carrot","lightbulb","apple-whole","ice-cream","gamepad","cookie-bite","eye","droplet","marker"];numbers=["\u06F1","\u06F2","\u06F3","\u06F4","\u06F5","\u06F6","\u06F7","\u06F8","\u06F9","\u06F1\u06F0","\u06F1\u06F1","\u06F1\u06F2","\u06F1\u06F3","\u06F1\u06F4","\u06F1\u06F5","\u06F1\u06F6","\u06F1\u06F7","\u06F1\u06F8"];gameTheme=null;gameSize=null;rights=0;moves=0;prepareGame(){btnClose.click();let g=document.querySelector(".game .sq-wrapper");g.innerHTML="",document.querySelector("#moves").innerText=toPersian(this.moves);let d=document.createElement("div");d.classList=`gameboard grid-${this.gameSize}`;let c=[];"icons"==this.gameTheme?c=(c=shuffle(this.icons)).slice(0,this.gameSize**2/2):"numbers"==this.gameTheme&&(c=this.numbers.slice(0,this.gameSize**2/2));let b=[];for(let e=0;e<this.gameSize**2/2;e++){let a=document.createElement("div");a.classList="game-item",a.dataset.id=e;let h=c.pop();"icons"==this.gameTheme?a.innerHTML=`<i class="fa fa-${h}"></i>`:"numbers"==this.gameTheme&&(a.innerHTML=`<span>${h}</span>`),a.innerHTML+='<span class="overlay"></span>',b.push(a),b.push(a)}shuffle(b);for(let f=0;f<b.length;f++)d.innerHTML+=b[f].outerHTML;g.appendChild(d)}endGame(a=!1){clearInterval(t),showScore(this,a)}constructor(a){this.gameTheme=a.get("theme"),this.gameSize=a.get("size"),this.prepareGame(),time=4==this.gameSize?61:121,t=setInterval(timer,1e3),timer()}addMove(){this.moves++,document.querySelector("#moves").innerText=toPersian(this.moves)}checkMoves(a){this.addMove(),a[0].dataset.id==a[1].dataset.id?(a.forEach(a=>{a.classList.add("passed"),a.classList.remove("show")}),this.rights++,this.rights==this.gameSize**2/2&&this.endGame(!0)):a.forEach(a=>{sleep(500).then(()=>{a.classList.remove("show")})})}}function startGame(a){let b=new FormData(a);game=new Game(b),document.querySelectorAll(".game-item").forEach(a=>{a.addEventListener("click",b=>{b.target.parentElement.classList.add("show");let a=document.querySelectorAll(".game-item.show");if(a.length>1){let c=document.querySelector(".gameboard");c.style.pointerEvents="none",sleep(500).then(()=>{c.style.pointerEvents="all"}),game.checkMoves(a)}})})}function restartGame(){clearInterval(t),scoreMenu.style.display="none",mainMenu.style.display="none",startGame(startForm)}function newGame(){clearInterval(t),mainMenu.style.display="flex",scoreMenu.style.display="none"}startForm.addEventListener("submit",a=>{a.preventDefault(),startGame(startForm),mainMenu.style.display="none"}),btnOpen.addEventListener("click",a=>{a.preventDefault(),nav.classList.add("open")}),btnClose.addEventListener("click",a=>{a.preventDefault(),nav.classList.remove("open")})